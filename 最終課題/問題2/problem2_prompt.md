# 問題2: 2準位系のエントロピーと温度の数値計算プロンプト

以下の要件に基づいて、統計力学における2準位系のエントロピーと温度の数値計算をPythonで実装し、結果を可視化・考察してください。

## 問題設定

### 物理系の設定

- **独立なN個の粒子**: 各粒子は2準位を持つ
- **エネルギー準位**: 
  - 基底状態: エネルギー 0
  - 励起状態: エネルギー ε
- **系の全エネルギー**: M個の粒子が励起状態にあるとき
  ```
  E = M ε
  ```
- **最大エネルギー**: 
  ```
  E₀ = N ε
  ```
- **規格化**: ε = 1, k_B = 1 として計算

### 実装条件

以下の3つの粒子数について計算を行う：
- N = 20
- N = 50  
- N = 100

各粒子数について、励起状態の粒子数 M は以下の範囲：
```
M = 0, 1, 2, ..., N
```

## 課題1: エントロピーの数値計算

### 目的
エネルギー E = M に対応する微視的状態数 W(M) とエントロピー S(M) を数値計算する。

### 計算式

**微視的状態数**:
```
W(M) = C(N, M) = N! / (M! (N-M)!)
```

**エントロピー**:
```
S(M) = ln W(M)
```

### 実装要件

1. **数値安定性の考慮**: 
   - 大きな階乗の直接計算を避ける
   - 以下の公式を使用して対数で計算：
   ```
   ln C(N, M) = Σ[k=1 to M] ln(N - k + 1) - Σ[k=1 to M] ln k
   ```

2. **計算範囲**: 
   - 各Nについて、すべてのM (0 ≤ M ≤ N) についてS(M)を計算
   - 結果の出力は不要（可視化のみ）

3. **実装方法**:
   - Pythonの`math.log`または`numpy.log`を使用
   - ループまたはベクトル化で実装

## 課題2: エントロピーS(E)のプロット

### 目的
課題1で得たエントロピーを正規化してプロットし、粒子数の違いによる挙動を比較する。

### プロット仕様

- **横軸**: x = E/E₀ = M/N (正規化エネルギー)
- **縦軸**: s = S/N (正規化エントロピー)
- **比較**: N = 20, 50, 100 の3つの結果を同一グラフにプロット
- **凡例**: 各粒子数を区別できるように表示

### 実装要件

1. **グラフ作成**: `matplotlib`を使用
2. **グラフの見やすさ**: 
   - 適切な線の種類・色で区別
   - 軸ラベル、タイトル、凡例を明記
3. **保存**: 図を適切なファイル名で保存（例: `entropy_plot.png`）

## 課題3: Stirling近似との比較（発展課題）

### 目的
熱力学極限（N → ∞）でのStirling近似による理論値と数値計算結果を比較する。

### 理論式

Stirling近似により、N → ∞ の極限で得られるエントロピー密度：
```
s_approx(x) = -[x ln x + (1 - x) ln(1 - x)]  (0 < x < 1)
```

### 実装要件

1. **理論曲線の計算**: 上記の式を実装
2. **プロット**: 課題2のグラフに理論曲線を重ねて表示
3. **比較**: 粒子数Nを大きくしたときの収束の様子を確認

### 注意事項

- x = 0 と x = 1 での特異点に注意（ln 0 の問題）
- 数値計算では x = 0, 1 を除外するか、適切に処理

## 課題4: 温度の数値計算

### 目的
エントロピーから温度を数値的に計算する。

### 温度の定義

```
1/T = (∂S/∂E)_N
```

### 数値微分の実装

離散データに対して、中心差分法を使用：
```
1/T(M) ≈ [S(M+1) - S(M-1)] / [E(M+1) - E(M-1)]
```

ただし、E = M なので：
```
1/T(M) ≈ [S(M+1) - S(M-1)] / 2
```

したがって：
```
T(M) ≈ 2 / [S(M+1) - S(M-1)]
```

### 実装要件

1. **計算範囲**: M = 0 と M = N は除外（境界条件）
2. **計算**: M = 1, 2, ..., N-1 について T(M) を計算
3. **エラーハンドリング**: 
   - S(M+1) = S(M-1) の場合（無限大温度）の処理
   - 数値的に不安定な場合の処理

## 課題5: Stirling近似での温度との比較（発展課題）

### 目的
熱力学極限での理論的温度と数値計算結果を比較する。

### 理論式

Stirling近似により得られる温度：
```
T_th(x) = [ln((1-x)/x)]^(-1)
```

### 実装要件

1. **理論曲線の計算**: 上記の式を実装
2. **プロット**: 
   - 横軸: x = E/E₀ = M/N
   - 縦軸: 温度 T
   - 数値計算結果と理論曲線を重ねて表示
3. **比較**: 有限粒子数系が熱力学極限にどのように近づくかを確認

### 注意事項

- x = 0.5 で温度が無限大になる点に注意
- 負の温度の出現についても考察が必要

## 課題6: 考察

### 考察項目

作成したグラフを基に、以下の点について考察してください：

1. **エントロピーの最大値**:
   - エントロピーが最大値を取るエネルギーを特定
   - その物理的理由を説明

2. **温度の符号**:
   - エントロピーが最大となるエネルギー付近で、温度が正か負かを確認
   - 負の温度が出現する理由を考察

3. **負の温度の物理的意味**:
   - 本問題設定において、負の温度が現れる理由を物理的に考察
   - 正の温度と負の温度の大小関係について説明

4. **実在系との関係**:
   - 実際の自然界で負の温度を示す系が少ない理由を考察

### 出力形式

- 各考察項目について、簡潔かつ物理的に正確にまとめる
- グラフを参照しながら説明
- 必要に応じて数式を使用

## 提出物

### 必須提出物

1. **Pythonスクリプト**:
   - すべての計算と可視化を含む `.py` ファイル
   - または Jupyter Notebook (`.ipynb`) 形式
   - コメントを適切に記述

2. **レポート**:
   - LaTeXで記述したPDF形式のレポート
   - 各課題の説明、図、考察を含む
   - 図は適切に挿入

### ファイル構成の推奨

```
問題2/
├── problem2.py          # メインの計算スクリプト
├── problem2.ipynb       # Jupyter Notebook（オプション）
├── problem2_report.tex  # LaTeXレポート
├── problem2_report.pdf  # 提出用PDF
└── figures/             # 図の保存先
    ├── entropy_plot.png
    └── temperature_plot.png
```

## 実装のヒント

### Pythonライブラリ

```python
import numpy as np
import matplotlib.pyplot as plt
from math import log
```

### 数値計算の注意点

1. **対数の計算**: `math.log` または `numpy.log` を使用
2. **配列操作**: NumPy配列を活用して効率的に計算
3. **プロット**: `matplotlib.pyplot` でグラフ作成

### コード構造の推奨

1. 関数定義:
   - `calculate_entropy(N, M)`: エントロピー計算
   - `calculate_temperature(S, M)`: 温度計算
   - `stirling_entropy(x)`: Stirling近似のエントロピー
   - `stirling_temperature(x)`: Stirling近似の温度

2. メイン処理:
   - 各Nについてループ
   - 計算とプロットの実行

## 評価基準

1. **正確性**: 計算結果が物理的に正しいか
2. **可視化**: グラフが適切で見やすいか
3. **考察**: 物理的洞察が深いか
4. **コード品質**: 読みやすく、コメントが適切か
5. **レポート**: 説明が明確で論理的か

---

このプロンプトに基づいて、統計力学の2準位系の数値計算と可視化を実装し、物理的考察を行ってください。
