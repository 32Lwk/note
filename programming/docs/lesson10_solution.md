# 課題10 解答

## 課題10-1

### (1) グラフの描画

関数 f(x) = 9x exp(-x²) + 1 のグラフを x = -3 ~ 3 の範囲で描画しました。

**極値点:**
- x = -0.707107, f(x) = -2.859937（極大値）
- x = 0.707107, f(x) = 4.859937（極小値）

**変曲点:**
- x = -1.224745, f(x) = -1.459498
- x = 0.000000, f(x) = 1.000000
- x = 1.224745, f(x) = 3.459498

グラフは `lesson10-1.png` に保存されています。

### (2) 考察

#### 変曲点や極値点の存在が Newton-Raphson 法の収束に与える影響

1. **極値点付近での問題:**
   - 極値点（x = ±0.707）では導関数 f'(x) = 0 となる
   - Newton-Raphson法の更新式は x_{n+1} = x_n - f(x_n)/f'(x_n) であるため、f'(x) ≈ 0 のとき、更新量が非常に大きくなり発散する可能性がある
   - 実際、初期値 x = -0.7（極値点に近い）では1回の反復で発散した

2. **変曲点付近での問題:**
   - 変曲点では2階導関数 f''(x) = 0 となる
   - 変曲点付近では曲率が変化し、関数の形状が複雑になる
   - 初期値が変曲点に近い場合、収束が不安定になる可能性がある

3. **収束しやすい条件:**
   - 解に近く、かつ導関数が0から十分離れている初期値では収束しやすい
   - 実際、初期値 x = -0.1（解 x ≈ -0.1125 に近い）では4回の反復で収束した

#### 解が存在しそうな x の区間の幅

グラフから、f(x) = 0 の解は以下の2つが存在します：

1. **区間1: [-0.2, 0]**
   - f(-0.2) < 0, f(0) = 1 > 0 より、中間値の定理からこの区間に解が存在
   - 実際の解: x ≈ -0.1125
   - 区間の幅: 0.2

2. **区間2: [-2, -1.5]**
   - f(-2) > 0, f(-1.5) < 0 より、この区間に解が存在
   - 実際の解: x ≈ -1.6409
   - 区間の幅: 0.5

## 課題10-2

### (1) Newton-Raphson法

#### 収束しやすい初期値: x = -0.1

**実行結果:**
- 反復回数: 4回
- 近似解: x = -0.1125269808958853

**収束しやすい理由（グラフの形状に基づく説明）:**
- 初期値 x = -0.1 は解 x ≈ -0.1125 に非常に近い
- この点では導関数 f'(x) ≈ 9.0（0から十分離れている）
- グラフの形状が単調で、解に向かって滑らかに収束できる
- 接線の傾きが適切で、更新量が適度である

#### 収束しづらい（発散する）初期値: x = -0.7

**実行結果:**
- 反復回数: 1回で発散
- 発散先: x = 25.23...

**発散する理由（グラフの形状に基づく説明）:**
- 初期値 x = -0.7 は極値点 x = -0.707 に非常に近い
- 極値点では f'(x) = 0 となるため、f'(x) ≈ 0 の状態になる
- Newton-Raphson法の更新式 x_{n+1} = x_n - f(x_n)/f'(x_n) において、分母が0に近いため更新量が非常に大きくなる
- グラフ上で接線がほぼ水平になり、次の点が解から大きく離れてしまう
- 結果として、解から遠ざかり発散する

### (2) 二分法

#### 区間1: [-0.2, 0]
- **反復回数:** 38回
- **近似解:** x = -0.112526980895927
- **解が求められた理由:**
  - 区間 [-0.2, 0] で f(-0.2) < 0, f(0) = 1 > 0 となり、中間値の定理により解が存在することが保証される
  - グラフ上でこの区間は単調増加しており、f(x) = 0 を横切る点が1つだけ存在する
  - 二分法は区間を毎回半分に縮小するため、確実に解に収束する

#### 区間2: [-2, -1.5]
- **反復回数:** 38回
- **近似解:** x = -1.640868806056460
- **解が求められた理由:**
  - 区間 [-2, -1.5] で f(-2) > 0, f(-1.5) < 0 となり、中間値の定理により解が存在することが保証される
  - グラフ上でこの区間も単調減少しており、f(x) = 0 を横切る点が1つだけ存在する

#### 反復回数の比較と考察

**Newton-Raphson法 vs 二分法:**
- **Newton-Raphson法（収束時）:** 4回
- **二分法:** 38回

**反復回数に大きな差が出る理由:**

1. **収束速度の違い:**
   - Newton-Raphson法は2次収束（誤差が各ステップで2乗に比例して減少）
   - 二分法は線形収束（誤差が各ステップで1/2に減少）

2. **初期値への依存性:**
   - Newton-Raphson法は適切な初期値（解に近く、導関数が0から離れている）を選べば非常に高速に収束
   - 二分法は初期値に依存せず、常に同じ速度で収束する

3. **計算コスト:**
   - Newton-Raphson法は各反復で f(x) と f'(x) の両方を計算する必要がある
   - 二分法は各反復で f(x) のみを計算すればよい

4. **安定性:**
   - Newton-Raphson法は不適切な初期値では発散する可能性がある
   - 二分法は常に収束が保証される（区間が適切であれば）

## 課題10-3

### (i) 台形公式が「直線で近似して面積を求めている」ことの説明

Figure 4の図を見ると：
- 積分区間 [a, b] を n 個の小区間に分割
- 各小区間 [x_i, x_{i+1}] において、曲線 f(x) を直線で近似している
- 具体的には、点 (x_i, f(x_i)) と点 (x_{i+1}, f(x_{i+1})) を結ぶ直線で曲線を近似
- この直線と x 軸で囲まれる台形の面積を計算し、それらを合計している
- 図形的には、各小区間で曲線の下の面積を台形（上底 f(x_i)、下底 f(x_{i+1})、高さ h）で近似している

### (ii) 台形公式の誤差が h² に比例する理由

講義資料の式(1)と式(2)の導出過程から：

1. **テイラー展開による説明:**
   - 各小区間 [x_i, x_{i+1}] で f(x) を x_i の周りでテイラー展開すると：
     f(x) = f(x_i) + f'(x_i)(x - x_i) + (1/2)f''(ξ)(x - x_i)²
   - 台形公式は1次式（直線）で近似するため、2次以上の項が誤差となる
   - 誤差項は (1/2)f''(ξ)(x - x_i)² の形になり、h² に比例する

2. **数値積分の誤差公式:**
   - 台形公式の誤差は E = -(b-a)h²f''(ξ)/12 の形で表される
   - ここで h = (b-a)/N であるため、誤差は h² に比例する

3. **実行結果からの確認:**
   - N = 100, 200, 400, 800 のとき、誤差/h² の値は約 0.167 でほぼ一定
   - これは誤差が O(h²) に従っていることを示している

### (iii) 台形公式による積分計算

**実行結果:**

```
台形公式による数値積分: ∫[0,π] sin(x) dx
真値: 2.000000000000000

     N            近似値                    誤差                         h
----------------------------------------------------------------------------
   100    1.999835503887444     1.644961125564226e-04     3.141592653589793e-02
   200    1.999958876479216     4.112352078378123e-05     1.570796326794897e-02
   400    1.999989719151513     1.028084848675448e-05     7.853981633974483e-03
   800    1.999997429789859     2.570210140939722e-06     3.926990816987242e-03

誤差の減少率（O(h²)の確認）:
     N           誤差/h²
----------------------------------------------------------------------------
   100 1.666694082877996e-01
   200 1.666673520541197e-01
   400 1.666668380040801e-01
   800 1.666667095613135e-01
```

**考察:**
- 分割数 N を2倍にするごとに、誤差は約1/4（h²に比例）に減少している
- 誤差/h² の値が約 0.167 でほぼ一定であることから、誤差が O(h²) に従って減少していることが確認できる
- これは理論的な予測と一致している

## 課題10-4

### シンプソン公式による積分計算

**実行結果:**

```
シンプソン公式による数値積分: ∫[0,π] sin(x) dx
真値: 2.000000000000000

     N            近似値                    誤差                         h
----------------------------------------------------------------------------
   100    2.000000010824504     1.082450440392790e-08     3.141592653589793e-02
   200    2.000000000676473     6.764730997588231e-10     1.570796326794897e-02
   400    2.000000000042275     4.227507233167671e-11     7.853981633974483e-03
   800    2.000000000002641     2.640998530978322e-12     3.926990816987242e-03

誤差の減少率（O(h⁴)の確認）:
     N          誤差/h⁴
----------------------------------------------------------------------------
   100 1.111241701264763e-02
   200 1.111145734063261e-02
   400 1.111027564473574e-02
   800 1.110525708438358e-02
```

**考察:**
- 分割数 N を2倍にするごとに、誤差は約1/16（h⁴に比例）に減少している
- 誤差/h⁴ の値が約 0.011 でほぼ一定であることから、誤差が O(h⁴) に従って減少していることが確認できる
- 台形公式（O(h²)）と比較すると、シンプソン公式ははるかに高精度である
- 例えば、N=100 のとき、台形公式の誤差は約 1.64×10⁻⁴ であるのに対し、シンプソン公式の誤差は約 1.08×10⁻⁸ と約15,000倍も小さい

**シンプソン公式の誤差が O(h⁴) に従う理由:**
- シンプソン公式は2次多項式（放物線）で関数を近似する
- テイラー展開において、3次以上の項が誤差となる
- 誤差項は f⁽⁴⁾(ξ)h⁴ の形になり、h⁴ に比例する
- 数値積分の誤差公式から、シンプソン公式の誤差は E = -(b-a)h⁴f⁽⁴⁾(ξ)/180 の形で表される
